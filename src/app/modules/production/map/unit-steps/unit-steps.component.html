<p-table
    [value]="steps" dataKey="id"
    [tableStyle]="{ 'min-width': '50rem' }"
    class="table-bordered table-small"
    (onEditComplete)="onEditComplete($event)">
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 10%">№</th>
            <th style="width: 16%">Цех</th>
            <th style="width: 16%" class="text-right">%</th>
            <th style="width: 16%" class="text-right">Цена</th>
            <th style="width: 16%" class="text-right">Время</th>
            <th style="width: 16%">Описания</th>
            <th style="width: 10%"></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-step let-editing="editing" let-rowIndex="rowIndex">
        <tr>
            <td>
                {{rowIndex + 1}}
            </td>
            <td [pEditableColumn]="step.name" pEditableColumnField="seh" [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <!--                        <select [(ngModel)]="step.seh_id" matNativeControl>-->
                        <!--                            <option *ngFor="let seh of sehs" [value]="seh.id">-->
                        <!--                                {{seh.name}}-->
                        <!--                            </option>-->
                        <!--                        </select>-->
                        <p-dropdown
                            [options]="sehs"
                            [(ngModel)]="step.seh_id"
                            BlockLateralArrowNavigation
                            optionLabel="name"
                            optionValue="id"
                            [style]="{'width':'100%'}"
                            class="small-input"
                            scrollHeight="300px"
                            [appendTo]="'body'"
                        />
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{getSehName(step.seh_id)}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.percent" pEditableColumnField="percent" class="text-right w-24"
                [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <p-inputNumber
                            mode="decimal"
                            BlockLateralArrowNavigation
                            [ngModel]="step.percent"
                            (ngModelChange)="handlePercentChange(rowIndex, $event, step.id)"
                            [minFractionDigits]="2" [maxFractionDigits]="5"
                            [min]="0" [max]="100"
                            locale="ru"
                            class="small-input"
                        />
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.percent / 100 | percent:'1.0-2'}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.cost" pEditableColumnField="cost" class="text-right">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <p-inputNumber
                            mode="decimal"
                            [(ngModel)]="step.cost"
                            BlockLateralArrowNavigation
                            [minFractionDigits]="0" [maxFractionDigits]="0"
                            [min]="0"
                            locale="ru"
                            class="small-input"
                        />
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.cost | currency:'UZS':'':'1.0-0'}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.duration" pEditableColumnField="duration" class="text-right">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <input pInputText type="text"
                               [(ngModel)]="step.duration"
                               BlockLateralArrowNavigation/>
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.duration}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.description" pEditableColumnField="description">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <input pInputText type="text"
                               [(ngModel)]="step.description"
                               BlockLateralArrowNavigation/>
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.description}}
                    </ng-template>
                </p-cellEditor>
            </td>
        </tr>
    </ng-template>
</p-table>
