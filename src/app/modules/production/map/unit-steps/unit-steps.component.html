<p-table #dt
    [value]="steps" dataKey="id"
    [tableStyle]="{ 'min-width': '50rem' }"
    class="table-bordered table-small"
    (onEditInit)="onEditInit($event)"
    (onEditCancel)="onEditCancel($event)"
    (onEditComplete)="onEditComplete($event)">
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 10%" class="text-center">№</th>
            <th style="width: 10%"></th>
            <th style="width: 16%">Цех</th>
            <th style="width: 16%" class="text-right">%</th>
            <th style="width: 16%" class="text-right">Цена</th>
            <th style="width: 16%" class="text-right">Время</th>
            <th style="width: 16%">Описания</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-step let-editing="editing" let-rowIndex="rowIndex">
        <tr>
            <td class="text-center">
                {{rowIndex + 1}}
            </td>
            <td class="text-center">
                <button mat-icon-button *ngIf="checkForChanged(step)" (click)="save(step)" color="warn" aria-label="Example icon button with a vertical three dot icon">
                    <mat-icon>save</mat-icon>
                </button>
            </td>
            <td [pEditableColumn]="step.name" pEditableColumnField="seh_id" [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <!--                        <select [(ngModel)]="step.seh_id" matNativeControl>-->
                        <!--                            <option *ngFor="let seh of sehs" [value]="seh.id">-->
                        <!--                                {{seh.name}}-->
                        <!--                            </option>-->
                        <!--                        </select>-->
                        <p-dropdown
                            [options]="sehs"
                            [ngModel]="step.seh_id"
                            (ngModelChange)="handleFieldChange(step.id, $event)"
                            BlockLateralArrowNavigation
                            optionLabel="name"
                            optionValue="id"
                            [style]="{'width':'100%'}"
                            class="small-input"
                            scrollHeight="300px"
                            [appendTo]="'body'"
                        />
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{getSehName(step.seh_id)}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.percent"
                pEditableColumnField="percent"
                class="text-right w-24"
                [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <p-inputNumber
                            mode="decimal"
                            BlockLateralArrowNavigation
                            [ngModel]="step.percent"
                            (ngModelChange)="handleFieldChange(step.id, $event)"
                            [minFractionDigits]="2" [maxFractionDigits]="5"
                            [min]="0" [max]="100"
                            locale="ru"
                            class="small-input"
                        />
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.percent / 100 | percent:'1.0-2'}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.cost" pEditableColumnField="cost" class="text-right"
                [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <p-inputNumber
                            mode="decimal"
                            [ngModel]="step.cost"
                            (ngModelChange)="handleFieldChange(step.id, $event)"
                            BlockLateralArrowNavigation
                            [minFractionDigits]="0" [maxFractionDigits]="0"
                            [min]="0"
                            locale="ru"
                            class="small-input"
                        />
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.cost | currency:'UZS':'':'1.0-0'}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.duration" pEditableColumnField="duration" class="text-right"
                [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <input pInputText type="text"
                               [ngModel]="step.duration"
                               (ngModelChange)="handleFieldChange(step.id, $event)"
                               BlockLateralArrowNavigation/>
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.duration}}
                    </ng-template>
                </p-cellEditor>
            </td>
            <td [pEditableColumn]="step.description" pEditableColumnField="description"
                [pEditableColumnRowIndex]="rowIndex">
                <p-cellEditor>
                    <ng-template pTemplate="input">
                        <input pInputText type="text"
                               [ngModel]="step.description"
                               (ngModelChange)="handleFieldChange(step.id, $event)"
                               BlockLateralArrowNavigation/>
                    </ng-template>
                    <ng-template pTemplate="output">
                        {{step.description}}
                    </ng-template>
                </p-cellEditor>
            </td>
        </tr>
    </ng-template>
</p-table>
